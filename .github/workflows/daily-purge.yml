name: Temporary Database Janitor

on:
  schedule:
    - cron: '55 11 * * *' 
  workflow_dispatch:

jobs:
  truncate-recent:
    name: Wipe Recent Table
    runs-on: ubuntu-latest
    steps:
      - name: Install PostgreSQL Client
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client

      - name: Truncate Table
        env:
          # Use the connection string from Supabase Settings > Database
          DB_URL: ${{ secrets.DATABASE_URL }}
        run: |
          echo "ðŸ§¹ Connecting to Supabase to wipe ingredients_recent..."
          
          # We wrap $DB_URL in quotes to handle special characters in passwords
          # We use RESTART IDENTITY so your IDs start back at 1
          psql "$DB_URL" -v ON_ERROR_STOP=1 -c "TRUNCATE TABLE public.ingredients_recent RESTART IDENTITY CASCADE;"
          
          echo "âœ… Table wiped successfully."